import type { Metadata } from "next";
import { Tajawal } from "next/font/google";
import "./globals.css";
import AppNavbar from "@/components/Navbar";
import Footer from "@/components/Footer";
import { NuqsAdapter } from "nuqs/adapters/next/app";
import AuthSessionProvider from "@/providers/AuthSessionProvider";
import { Toaster } from "sonner";
import { HugeiconsIcon } from "@hugeicons/react";
import {
  AlertDiamondIcon,
  AlertSquareIcon,
  Loading03Icon,
  Tick02Icon,
} from "@hugeicons/core-free-icons";
import { CartResponse } from "@/types/carts";
import { cart } from "@/features/cart/api/api";

const tajawal = Tajawal({
  subsets: ["arabic", "latin"],
  weight: ["400", "500", "700"],
  variable: "--font-tajawal",
  display: "swap",
});

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
  generator: "v0.app",
};

export default async function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  let cartItems: CartResponse | null = null;
  try {
    const cartRes = await cart.get("", {
      adapter: "fetch",
      fetchOptions: { cache: "no-store" },
    });
    cartItems = cartRes.data;
  } catch (error) {}
  return (
    <html lang="en" dir="rtl" className={`${tajawal.variable}`}>
      <body className="antialiased font-tajawal ">
        <AuthSessionProvider>
          <AppNavbar cartItems={cartItems?.data.items.length || 0} />

          <NuqsAdapter>{children}</NuqsAdapter>
          <Footer />
          <Toaster
            closeButton
            position="top-center"
            richColors
            toastOptions={{
              style: {
                borderRadius: 0,
              },
            }}
            icons={{
              success: <HugeiconsIcon icon={Tick02Icon} size={16} />,
              info: <HugeiconsIcon icon={AlertSquareIcon} size={16} />,
              warning: <HugeiconsIcon icon={AlertSquareIcon} size={16} />,
              error: <HugeiconsIcon icon={AlertDiamondIcon} size={16} />,
              loading: (
                <HugeiconsIcon
                  icon={Loading03Icon}
                  className="animate-spin"
                  size={16}
                />
              ),
            }}
          />
        </AuthSessionProvider>
      </body>
    </html>
  );
}
